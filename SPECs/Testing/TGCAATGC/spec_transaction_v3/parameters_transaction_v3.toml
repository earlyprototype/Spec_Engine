# Parameters for Charity Shop POS - Complete System (v3)
# Generated by Spec_Commander.md (Article XIV compliant)
# Date: 2025-11-02T07:15:00Z

[meta]
file_role = "Machine-readable parameters for structured execution"
created_by = "commander-spec.md"
goal_descriptor = "transaction_v3"
related_files = ["spec_transaction_v3.md", "exe_transaction_v3.md"]
log_output = "progress_transaction_v3.json"
created_date = "2025-11-02"
version = "3.0"

[execution]
default_mode = "dynamic"
confidence_threshold = 0.6

[goal]
description = "Build a complete point-of-sale transaction system for charity shop volunteers that handles cash and card payments, prints itemised receipts, tracks daily totals, and integrates with Square payment processor."

# === MANDATORY FOR BUILD/CREATE/SYSTEM GOALS ===
# Article XIV: Complete Systems Require Deployable Artifacts

[software_stack]
deployment_type = "desktop_app"
primary_language = "python"
framework = "pyqt5"
database = "sqlite"
ui_library = "pyqt5"
packaging_method = "pyinstaller"

[user_interface]
required = true  # Goal says "for charity shop volunteers"
interface_type = "gui"
target_users = "charity shop volunteers"
skill_level = "none"  # Non-technical users
accessibility = ["large_buttons", "simple_language", "high_contrast", "touch_friendly"]

[deployment]
target_platform = "windows"
installation_type = "portable_exe"  # No installer needed, can run from USB
configuration_required = ["square_api_credentials", "printer_com_port", "shop_details"]
startup_method = "desktop_icon"  # Double-click volunteers_pos.exe or desktop shortcut

[completion_criteria]
# MANDATORY: Defines when goal is ACHIEVED (not just steps completed)
functional_complete = true  # Cash+card+receipts+reports all working
interface_complete = true   # PyQt5 GUI implemented and tested
deployment_complete = true  # volunteers_pos.exe tested on clean Windows machine
production_ready = true     # Real Square API (not test mode)
user_tested = true         # Non-technical volunteer completed test workflows
documentation_complete = true  # User guide and installation guide exist

# Detailed acceptance criteria (from Definition of Complete in spec)
acceptance_criteria = [
    "Volunteer processes £5.99 cash sale, system calculates £4.01 change correctly",
    "Volunteer processes £25.00 card payment via actual Square production API",
    "Receipt prints to physical thermal printer with charity info",
    "End-of-day report shows cash/card totals and till balance",
    "System handles network failures gracefully (cash works offline)",
    "volunteers_pos.exe exists and runs on clean Windows 10 without Python",
    "Configuration wizard guides volunteer through Square API setup",
    "Non-technical volunteer completes 5 sales without assistance",
    "Volunteer recovers from printer/card/network errors without help",
    "Square API uses production endpoint with configurable credentials"
]

# === OPTIONAL: Components & Constraints ===

[components]
main_window = "PyQt5 main application window at src/gui/main_window.py"
payment_backend = "Payment processing module at src/payment_processor.py"
database = "SQLite database at data/transactions.db"
printer_interface = "Thermal printer wrapper at src/printer.py"
configuration = "JSON settings file at config/settings.json"

[constraints]
offline_capable = true  # Cash transactions work without network
gdpr_compliant = true  # No personal customer data stored
precision_decimal = true  # Use Decimal for all monetary calculations
max_transaction_time_seconds = 2
security_card_data_local = false  # Card data never stored locally
output_format_receipt = "thermal_text"  # 32-char width thermal format
output_format_report = "plain_text"

# === Tasks and Steps ===

[[tasks]]
id = 1
description = "Build PyQt5 Desktop Application GUI"
research_enabled = false

[[tasks.steps]]
id = 1
description = "Create main window with volunteer interface"
expected_output = "src/gui/main_window.py with functional window, buttons clickable"
critical = true
mode = "dynamic"
max_retries = 2
[[tasks.steps.backups]]
id = 1
description = "Code PyQt5 layout manually using QVBoxLayout if Qt Designer unavailable"
trigger_condition = "primary_failure"
execution_method = "cognitive"

[[tasks.steps]]
id = 2
description = "Create cash sale dialog"
expected_output = "src/gui/cash_dialog.py with working dialog, live change calculation"
critical = true
mode = "dynamic"
max_retries = 2
[[tasks.steps.backups]]
id = 1
description = "Use QDoubleValidator for input fields if validation complex"
trigger_condition = "primary_failure"
execution_method = "cognitive"

[[tasks.steps]]
id = 3
description = "Create card sale dialog"
expected_output = "src/gui/card_dialog.py with Square integration, user-friendly error messages"
critical = true
mode = "dynamic"
max_retries = 2
[[tasks.steps.backups]]
id = 1
description = "Show clear error messages for common Square API failures if SDK integration complex"
trigger_condition = "primary_failure"
execution_method = "cognitive"

[[tasks.steps]]
id = 4
description = "Integrate backend with GUI"
expected_output = "Fully functional GUI→backend data flow, transactions logged to database"
critical = true
mode = "dynamic"
max_retries = 2
[[tasks.steps.backups]]
id = 1
description = "Use direct function calls with try/except if signal/slot pattern too complex"
trigger_condition = "primary_failure"
execution_method = "cognitive"

[[tasks]]
id = 2
description = "Implement Production-Ready Backend"
research_enabled = false

[[tasks.steps]]
id = 1
description = "Configure Square API for production use"
expected_output = "src/payment_processor.py with production Square API, credentials from config file"
critical = true
mode = "dynamic"
max_retries = 2
[[tasks.steps.backups]]
id = 1
description = "Fall back to cash-only mode with clear warning if production API fails"
trigger_condition = "primary_failure"
execution_method = "cognitive"

[[tasks.steps]]
id = 2
description = "Implement offline-capable cash transactions"
expected_output = "Cash transactions work offline, sync automatically when network available"
critical = true
mode = "dynamic"
max_retries = 2
[[tasks.steps.backups]]
id = 1
description = "Add manual sync button in GUI if background sync fails"
trigger_condition = "primary_failure"
execution_method = "cognitive"

[[tasks.steps]]
id = 3
description = "Implement robust printer interface"
expected_output = "src/printer.py with error handling, fallback to file if printer unavailable"
critical = false  # System must work without printer
mode = "dynamic"
max_retries = 2
[[tasks.steps.backups]]
id = 1
description = "Prompt volunteer to select COM port from dropdown if auto-detect fails"
trigger_condition = "primary_failure"
execution_method = "cognitive"
[[tasks.steps.backups]]
id = 2
description = "Save all receipts to file, offer batch print later if printer unavailable"
trigger_condition = "backup_1_failure"
execution_method = "cognitive"

[[tasks]]
id = 3
description = "Package as Deployable Executable"
research_enabled = false

[[tasks.steps]]
id = 1
description = "Configure PyInstaller for single-file executable"
expected_output = "volunteers_pos.spec configured, dist/volunteers_pos.exe builds successfully"
critical = true
mode = "dynamic"
max_retries = 2
[[tasks.steps.backups]]
id = 1
description = "Use one-folder mode if single-file too slow or fails to bundle"
trigger_condition = "primary_failure"
execution_method = "cognitive"

[[tasks.steps]]
id = 2
description = "Build and test executable on clean system"
expected_output = "volunteers_pos.exe tested on clean Windows 10 VM, all functionality works"
critical = true
mode = "dynamic"
max_retries = 2
[[tasks.steps.backups]]
id = 1
description = "Use pyinstaller --onefile --hidden-import=square to bundle missing dependencies"
trigger_condition = "primary_failure"
execution_method = "tool"

[[tasks.steps]]
id = 3
description = "Create first-run configuration wizard"
expected_output = "src/gui/setup_wizard.py, config/settings.json created after first run"
critical = true
mode = "dynamic"
max_retries = 2
[[tasks.steps.backups]]
id = 1
description = "Provide manual configuration option if auto-detect fails"
trigger_condition = "primary_failure"
execution_method = "cognitive"

[[tasks]]
id = 4
description = "Create User Documentation"
research_enabled = false

[[tasks.steps]]
id = 1
description = "Write volunteer user guide"
expected_output = "docs/VOLUNTEER_GUIDE.md with step-by-step instructions and screenshots"
critical = false  # Documentation important but not critical for functionality
mode = "dynamic"
max_retries = 1
[[tasks.steps.backups]]
id = 1
description = "Create PDF with large text and images if markdown too technical for volunteers"
trigger_condition = "primary_failure"
execution_method = "cognitive"

[[tasks.steps]]
id = 2
description = "Create installation and configuration guide"
expected_output = "docs/INSTALLATION.md with system requirements and Square API setup"
critical = true  # Shop managers need this to deploy system
mode = "dynamic"
max_retries = 2
[[tasks.steps.backups]]
id = 1
description = "Include common troubleshooting section if initial guide too brief"
trigger_condition = "primary_failure"
execution_method = "cognitive"

[error_propagation]
enabled = true
read_prior_steps = true
dependency_tracking = true
propagation_strategy = "collaborative_review"
failure_threshold = 3

[logging]
output_file = "progress_transaction_v3.json"
log_events = ["start", "step_complete", "retry", "error", "completion", "mode_switch"]
record_retries = true
record_timestamps = true
record_mode_switches = true

[verification]
check_task_alignment = true
check_step_order = true
check_file_integrity = true
check_mode_consistency = true
validate_backup_coverage = true
verify_cross_references = true
check_expected_outputs = true
validate_backup_trigger_conditions = true

# Article XIV Enforcement: Exe Section 1.1a will validate software_stack
# Article XIV Enforcement: Exe Section 6.4 will verify deployment_complete before marking ACHIEVED

[progress_tracking]
progress_file = "progress_transaction_v3.json"
fields = ["task_id", "step_id", "status", "retry_count", "timestamp", "message", "deployment_verification"]
update_frequency = "on_step_completion"



